{% extends "base.html" %}

{% block title %}Forgot Password - ResearchHub Pro{% endblock %}

{% block content %}
<div class="auth-layout" aria-labelledby="forgotHeading">
    <div class="auth-panel" role="form">
        <div class="logo-mark" aria-hidden="true"><i class="fas fa-key"></i></div>
        <div class="text-center">
            <span class="section-label">Password reset</span>
            <h1 id="forgotHeading">Need a new password?</h1>
            <p class="mb-0">Enter the email associated with your account and we will send reset instructions.</p>
        </div>
        <form id="forgotPasswordForm" class="d-grid gap-3" novalidate>
            <div>
                <label for="resetEmail" class="form-label">Work email</label>
                <input type="email" class="form-control" id="resetEmail" autocomplete="email" required aria-required="true">
            </div>
            <button type="submit" class="btn btn-primary w-100" id="forgotSubmitBtn">
                <span class="default-label"><i class="fas fa-envelope me-1"></i> Send reset email</span>
                <span class="spinner-label d-none"><i class="fas fa-spinner fa-spin me-2"></i> Sendingâ€¦</span>
            </button>
        </form>
        <div class="auth-links">
            <span><a href="/login">Return to sign in</a></span>
            <span><a href="/register">Create a new account</a></span>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
(function() {
    const form = document.getElementById('forgotPasswordForm');
    const submitBtn = document.getElementById('forgotSubmitBtn');

    function setSubmitting(submitting) {
        submitBtn.disabled = submitting;
        submitBtn.querySelector('.default-label').classList.toggle('d-none', submitting);
        submitBtn.querySelector('.spinner-label').classList.toggle('d-none', !submitting);
    }

    form.addEventListener('submit', async (event) => {
        event.preventDefault();
        if (!form.checkValidity()) {
            form.classList.add('was-validated');
            return;
        }

        const email = document.getElementById('resetEmail').value.trim();
        if (!email) {
            showAlert('Please enter your email address.', 'warning');
            return;
        }

        try {
            setSubmitting(true);
            await requestPasswordReset(email);
            setTimeout(() => {
                window.location.href = '/login';
            }, 1200);
        } catch (error) {
            console.warn('Password reset request error:', error);
        } finally {
            setSubmitting(false);
        }
    });
})();
</script>
{% endblock %}
