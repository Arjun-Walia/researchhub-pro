{% extends "base.html" %}

{% block title %}Dashboard - ResearchHub Pro{% endblock %}

{% block content %}
<div class="page-header">
    <div class="page-title">
        <span class="section-label">Research overview</span>
        <h1>Welcome back, <span id="dashboardFirstName">Researcher</span>.</h1>
        <p class="page-subtitle">Track how your team is searching, curating, and publishing intelligence across ResearchHub Pro.</p>
    </div>
    <div class="d-flex flex-wrap gap-2 align-items-center">
        <a href="/search" class="btn btn-primary">
            <i class="fas fa-magnifying-glass"></i>
            New AI search
        </a>
        <a href="/projects" class="btn btn-secondary">
            <i class="fas fa-folder-plus"></i>
            Launch project workspace
        </a>
    </div>
</div>

<div class="surface-subtle integration-capability-banner fade-up d-none mb-4" id="dashboardCapabilityBanner" role="status" aria-live="polite"></div>

<div class="metric-grid mb-4">
    <div class="surface-card metric-card fade-up" id="metricSearches">
        <div class="metric-header">
            <div>
                <span class="section-label">Searches Today</span>
                <div class="metric-value" id="searchesTodayValue" data-counter>0</div>
            </div>
            <span class="metric-icon"><i class="fas fa-search"></i></span>
        </div>
        <div class="metric-trend" id="searchesTrendText">Monitoring live researcher momentum</div>
    </div>
    <div class="surface-card metric-card fade-up" id="metricProjects">
        <div class="metric-header">
            <div>
                <span class="section-label">Active Projects</span>
                <div class="metric-value" id="totalProjectsValue" data-counter>0</div>
            </div>
            <span class="metric-icon"><i class="fas fa-diagram-project"></i></span>
        </div>
        <div class="metric-trend">Pinned projects are surfaced first for collaborators.</div>
    </div>
    <div class="surface-card metric-card fade-up" id="metricCollections">
        <div class="metric-header">
            <div>
                <span class="section-label">Collections</span>
                <div class="metric-value" id="totalCollectionsValue" data-counter>0</div>
            </div>
            <span class="metric-icon">
                <span class="ui-bookmark ui-bookmark--static" aria-hidden="true">
                    <input type="checkbox" checked>
                    <span class="bookmark">
                        <svg viewBox="0 0 32 32" aria-hidden="true" focusable="false">
                            <path d="M27 4v27a1 1 0 0 1-1.625.781L16 24.281l-9.375 7.5A1 1 0 0 1 5 31V4a4 4 0 0 1 4-4h14a4 4 0 0 1 4 4z"></path>
                        </svg>
                    </span>
                </span>
            </span>
        </div>
        <div class="metric-trend">Curated dossiers stay synced with your latest findings.</div>
    </div>
    <div class="surface-card metric-card fade-up" id="metricSaved">
        <div class="metric-header">
            <div>
                <span class="section-label">Saved Results</span>
                <div class="metric-value" id="savedResultsValue" data-counter>0</div>
            </div>
            <span class="metric-icon"><i class="fas fa-stars"></i></span>
        </div>
        <div class="metric-trend">Exports and citations remain audit-ready.</div>
    </div>
</div>

<div class="row g-4 align-items-stretch">
    <div class="col-12 col-xl-8">
        <div class="surface-card elevated analytics-card h-100">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <span class="section-label">Engagement</span>
                    <h3 class="mb-1">This week's intelligence pulse</h3>
                    <p class="mb-0 text-muted">Insights based on the last seven days of platform activity.</p>
                </div>
                <span class="badge badge-accent badge-pulse">Live</span>
            </div>
            <div class="engagement-chart" aria-live="polite">
                <canvas id="engagementChart" aria-label="Weekly engagement breakdown" role="img"></canvas>
                <div class="chart-empty" id="engagementChartEmpty">
                    <i class="fas fa-chart-simple"></i>
                    <p class="mb-0">Collecting enough activity data to plot your first insights.</p>
                </div>
            </div>
            <div class="quick-action-grid">
                <a href="/collections" class="quick-action-card">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h5 class="mb-1">Review collections</h5>
                            <p class="mb-2 text-muted">Spot new additions and share highlights with stakeholders.</p>
                        </div>
                        <span class="badge badge-neutral"><i class="fas fa-circle-check me-1"></i>Ready</span>
                    </div>
                    <span class="text-muted">View all collections</span>
                </a>
                <button class="quick-action-card w-100 text-start" type="button" onclick="exportData()">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h5 class="mb-1">Export briefing</h5>
                            <p class="mb-2 text-muted">Deliver PDF, Markdown, and Excel packs in one click.</p>
                        </div>
                        <span class="badge badge-positive"><i class="fas fa-arrow-up-right-from-square me-1"></i>New</span>
                    </div>
                    <span class="text-muted">Launch export workflow</span>
                </button>
                <a href="/projects" class="quick-action-card">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h5 class="mb-1">Coordinate teams</h5>
                            <p class="mb-2 text-muted">Assign research sprints and track collaborator updates.</p>
                        </div>
                        <span class="badge badge-neutral"><i class="fas fa-users me-1"></i>Teams</span>
                    </div>
                    <span class="text-muted">Open project hub</span>
                </a>
            </div>
        </div>
    </div>
    <div class="col-12 col-xl-4 d-flex flex-column gap-4">
        <div class="surface-card feed-card">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <div>
                    <span class="section-label">Notifications</span>
                    <h4 class="mb-0">Action items</h4>
                </div>
                <span class="badge badge-accent">3 new</span>
            </div>
            <div id="dashboardNotifications" class="feed-list">
                <div class="feed-item">
                    <span class="feed-icon"><i class="fas fa-bell"></i></span>
                    <div class="feed-body">
                        <strong>No new notifications.</strong>
                        <p class="mb-0 text-muted">We will surface approvals and AI review items right here.</p>
                    </div>
                </div>
            </div>
        </div>
    <div class="surface-card feed-card flex-grow-1">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <div>
                    <span class="section-label">Recent activity</span>
                    <h4 class="mb-0">Live stream</h4>
                </div>
            </div>
            <div id="activityFeed" class="scrollable-feed">
                <div class="text-center text-muted py-4">
                    <div class="dot-spinner dot-spinner--lg dot-spinner--neutral mb-2" aria-hidden="true">
                        <div class="dot-spinner__dot"></div>
                        <div class="dot-spinner__dot"></div>
                        <div class="dot-spinner__dot"></div>
                        <div class="dot-spinner__dot"></div>
                        <div class="dot-spinner__dot"></div>
                        <div class="dot-spinner__dot"></div>
                        <div class="dot-spinner__dot"></div>
                        <div class="dot-spinner__dot"></div>
                    </div>
                    <p class="mb-0">Loading activity...</p>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="surface-card mt-4">
    <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3">
        <div>
            <span class="section-label">Latest queries</span>
            <h3 class="mb-0">Recent searches</h3>
        </div>
        <a href="/search-history" class="btn btn-ghost btn-sm">
            <i class="fas fa-clock-rotate-left me-1"></i>
            View history
        </a>
    </div>
    <div class="table-responsive">
        <table class="table-modern" id="recentSearchesTable">
            <thead>
                <tr>
                    <th>Query</th>
                    <th>Results</th>
                    <th>When</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="4" class="text-center">
                        <div class="empty-state">
                            <div class="icon"><i class="fas fa-magnifying-glass"></i></div>
                            <p class="mb-0 text-muted">Fetching your most recent searches...</p>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.6/dist/chart.umd.min.js" crossorigin="anonymous"></script>
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
